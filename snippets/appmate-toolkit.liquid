{{ '//toolkit.appmate.io/appmate-loader.js' | script_tag }}
{{ 'appmate-wishlist.scss.css' | asset_url | stylesheet_tag }}
{% include 'appmate-markup' %}

<script type="text/javascript">
    ;(function(){
        if (typeof Appmate === 'undefined') return; // In case lib didn't load.

        Appmate.init({
            app: {
                autoLoad: true
            },
            shop: {
                domain: '{{ shop.domain }}',
                affiliate: 'my-affiliate-key'
            },
            session: {
                customer: '{{ customer.id }}',
                cacheScripts: true,
                expiration: 14
            },

            wishlist: {
                loginRequired: false
            },

            globals: {
                settings: {{ settings | json }}
            }
        });

        // Flavor: Extended with callbacks
        Appmate.on({
            'click .wishlist-remove-button': function(event){
                event.preventDefault();

                var item = this.getAttribute('data-wishlist-item');

                Appmate.wishlist.removeItem(item)
                    .then(function(){
                        console.log('Item removed.');
                    })
                    .catch(function(error){
                        console.error(error);
                    });

            },
            'click .wishlist-toggle-button': function(event){
                event.preventDefault();

                var product = this.getAttribute('data-product');
                var variant = $(this).parents('form').find('select[name="id"]').val();

                Appmate.wishlist.toggleProduct(product, variant)
                    .then(function(){
                        console.log('Item toggled.');
                    })
                    .catch(function(error){
                        console.error(error);
                    });

            },
            'click .wishlist-clear-button': function(event){
                event.preventDefault();

                Appmate.wishlist.clear()
                    .then(function(){
                        console.log('Wish list cleared.');
                    })
                    .catch(function(error){
                        console.error(error);
                    });

            },
            'render .wishlist-option-select': function(elem){
                initOptionSelect(elem);
            },
            'destroy .wishlist-option-select': function(elem){
                console.log('Destroy element', elem);
            },
            'render .add-to-cart': function(elem){
                initAddToCart(elem);
            },
            'destroy .add-to-cart': function(elem){
                console.log('Destroy element', elem);
            }
        });

        // Flavor: Compact
        // Appmate.on({
        //     'click .wishlist-remove-button': 'wishlist.removeProduct',
        //     'click .wishlist-toggle-button': 'wishlist.toggleProduct'
        // });

    })();

</script>
